[supervisord]
nodaemon=true
logfile=/var/log/supervisor/supervisord.log  ; Path to the main log file
logfile_maxbytes=5MB                        ; Max size of the log file before rotation
logfile_backups=5
pidfile=/var/run/supervisord.pid  ; Specify the location of the PID file

[program:gunicorn]
command=gunicorn --bind 0.0.0.0:8000 config.wsgi:application --env GUNICORN_SERVER=true --access-logfile - --error-logfile - --log-level info --capture-output
directory=/code
autostart=true
autorestart=true

[program:celery]
command=celery -A config.celery worker --loglevel=info
directory=/code
autostart=true
autorestart=true
stderr_logfile=/var/log/supervisor/celery.err.log  ; Log file for standard error
stdout_logfile=/var/log/supervisor/celery.out.log  ; Log file for standard output

[program:celery-beat]
command=celery -A config.celery beat --loglevel=info
directory=/code
autostart=true
autorestart=true
stderr_logfile=/var/log/supervisor/celery-beat.err.log
stdout_logfile=/var/log/supervisor/celery-beat.out.log

[program:redis]
command=bash -c 'if [ -n "$REDIS_PASSWORD" ]; then exec redis-server --protected-mode yes --requirepass "$REDIS_PASSWORD" --save ""; else exec redis-server --protected-mode no --save ""; fi'
autostart=true
autorestart=true
